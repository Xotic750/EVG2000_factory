<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<% meta_get(); %>
<title>Port Triggering Services</title>
<link rel="stylesheet" href="form.css">
<STYLE TYPE="text/javascript">
	classes.num.all.fontFamily = "Courier";
	classes.num.all.fontSize = "10pt" ;
</style>
<% script_get(); %>
<script language="javascript" type="text/javascript">
<!-- hide script from old browsers
var df_sel = <% fw_cgi_pt_get_policy_param("df_sel"); %>;
var fwpt_action = <% fw_cgi_pt_get_policy_param("fwpt_action"); %>;

function setsrc()
{
	var cf = document.forms[0];
	var type = cf.src_ip_type.selectedIndex;
	if (type == 1)
	{
		cf.src_ip1.disabled = false;
		cf.src_ip2.disabled = false;
		cf.src_ip3.disabled = false;
		cf.src_ip4.disabled = false;
	}
	else
	{
		cf.src_ip1.disabled = true;
		cf.src_ip2.disabled = true;
		cf.src_ip3.disabled = true;
		cf.src_ip4.disabled = true;
	}
}

function setDisable(disable)
{
	var cf = document.forms[0];
	cf.pt_name.disabled = disable;
	cf.pt_type.disabled = disable;
	cf.pt_port.disabled = disable;
	cf.in_port_type.disabled = disable;
	cf.in_port_start.disabled = disable;
	cf.in_port_end.disabled = disable;
}

function loadSettings()
{
	var cf = document.forms[0];
	var src_ip_type = "<% fw_cgi_pt_get_policy_param("src_ip_type");%>";
	if (src_ip_type == "2")
	{
		var src_ip = cf.src_ip.value.split(".");
		cf.src_ip1.value = src_ip[0];
		cf.src_ip2.value = src_ip[1];
		cf.src_ip3.value = src_ip[2];
		cf.src_ip4.value = src_ip[3];
		cf.src_ip_type.selectedIndex = 1;
	}
	else
	{
		cf.src_ip_type.selectedIndex = 0;
		cf.src_ip1.value = "";
		cf.src_ip2.value = "";
		cf.src_ip3.value = "";
		cf.src_ip4.value = "";
	}
	setsrc();

	var pt_type = "<% fw_cgi_pt_get_policy_param("pt_type");%>";
	if (pt_type == "17")
		cf.pt_type.selectedIndex = 1;
	else
		cf.pt_type.selectedIndex = 0;
	cf.pt_port.value = "<% fw_cgi_pt_get_policy_param("pt_port"); %>";

	var in_port_type = "<% fw_cgi_pt_get_policy_param("in_port_type");%>";
	if (in_port_type == "6")
		cf.in_port_type.selectedIndex = 1;
	else if (in_port_type == "17")
		cf.in_port_type.selectedIndex = 2;
	else
		cf.in_port_type.selectedIndex = 0;
	cf.in_port_start.value = "<% fw_cgi_pt_get_policy_param("in_port_start"); %>";
	cf.in_port_end.value = "<% fw_cgi_pt_get_policy_param("in_port_end"); %>";

	if (df_sel)
		setDisable(true);
}

function checkPort(name, port)
{
	var msg = "";
	var portNum = parseInt(port);

	if (port.length == 0)
		msg = name + " must not be blank\n";
	if (isNaN(portNum) || portNum == 80 || portNum < 1 || portNum > 65535)
		msg = "Invalid " + name + ", must be between 1 and 65535 excluding 80\n";
	return msg;
}

function checkData()
{
	var cf = document.forms[0];
	var msg = "";

	if (cf.pt_name.value.length == 0)
		msg += "Service name must not be blank\n";

	if (cf.src_ip_type.selectedIndex == 1)
	{
		if(checkIP(cf.src_ip1,cf.src_ip2,cf.src_ip3,cf.src_ip4,254)||(parseInt(cf.src_ip4.value)==0))
			msg+= "Invalid service user IP address\n";
	}

	msg += checkPort("Triggering port", cf.pt_port.value);

	msg += checkPort("Inbound connection start port", cf.in_port_start.value);

	if (cf.in_port_end.value.length > 0)
	{
		msg += checkPort("Inbound connection end port", cf.in_port_end.value);
		if (parseInt(cf.in_port_end.value) < parseInt(cf.in_port_start.value))
			msg += "Invalid inbound connection port range\n";
	}

	if (msg.length > 0)
	{
		alert(msg);
		return false;
	}
	
	cf.src_ip.value = cf.src_ip1.value+'.'+cf.src_ip2.value+'.'+cf.src_ip3.value+'.'+cf.src_ip4.value;
	if (cf.in_port_end.value.length == 0)
		cf.in_port_end.value = cf.in_port_start.value;

	setDisable(false);
	return true;
}

//-->
</script>
</head>
<body bgcolor="#ffffff" onload="loadSettings();loadhelp('FW_pt');document.forms[0].elements[0].focus();">
<form name="formname" action="fwpt_service.cgi" method="POST">
<table border="0" cellpadding="0" cellspacing="3" width="100%">
<tr>
	<td colspan="2"><h1>Port Triggering - Services</h1></td></tr>
<tr>
	<td colspan="2" background="liteblue.gif" height="12">&nbsp; </td></tr>
<tr>
<td colspan="2">
	<table border ="0" cellpadding ="0" cellspacing ="0" width="100%">
	<tr>
	<td colspan="2"><tabindex="-1"><b>Service</b></a></td></tr>
	<tr>
	<TD NOWRAP width="37%">Service Name</td>
	<TD NOWRAP width="63%"><input type="text" tabindex=1 name="pt_name" size="15" maxlength="15" value="<% fw_cgi_pt_get_policy_param("pt_name"); %>"></td>
	</tr>
	<tr>
	<td nowrap width="37%">Service User</td>
	<td nowrap width="63%">
	<select name="src_ip_type" tabindex=2 onChange="setsrc();">
		<option value=1>Any</option>
		<option value=2>Single address</option>
	</select>
	</td>
	</tr>
	<tr></tr>
	<tr>
	<td nowrap width="37%"></td>
	<td nowrap width="63%"><span class="num">
	<input type="text" class="num" size="4" name="src_ip1" tabindex=3 maxlength="3">.<input type="text" class="num" size="4" maxlength="3" name="src_ip2" tabindex=4>.<input type="text" class="num" size="4" maxlength="3" name="src_ip3" tabindex=5>.<input type="text" class="num" size="4" maxlength="3" name="src_ip4" tabindex=6>
	</span></td>
	</tr>      
	<tr>
	<TD NOWRAP width="37%">Service Type</td>
	<TD NOWRAP width="63%">
		<select name="pt_type" tabindex=7 size="1">
		<option value=6>TCP</option>
		<option value=17>UDP</option>
		</SELECT></TD>
	</TR>
	<tr>
	<TD NOWRAP width="37%">Triggering Port</td>
	<TD NOWRAP width="63%"><input type="text" class="num" name="pt_port" size="6" maxlength="5" tabindex=8>(1~65535)</td>
	</tr>
	<tr>
	<td colspan="2" background="liteblue.gif" height="12">&nbsp; </td></tr>
	<tr>
	<td colspan="2"><tabindex="-1"><b>Required Inbound Connection</b></a></td></tr>
	<tr>
	<TD NOWRAP width="37%">Connection Type</td>
	<TD NOWRAP width="63%">
		<select name="in_port_type" tabindex=9 size="1">
		<option value=100>TCP/UDP</option>
		<option value=6>TCP</option>
		<option value=17>UDP</option>
		</SELECT></TD>
	</TR>
	<tr>
	<TD NOWRAP width="37%">Starting Port</td>
	<TD NOWRAP width="63%"><input type="text" class="num" name="in_port_start" size="6" maxlength="5" tabindex=10>(1~65535)</td>
	</tr>
	<tr>
	<TD NOWRAP width="37%">Ending Port</td>
	<TD NOWRAP width="63%"><input type="text" class="num" name="in_port_end" size="6" maxlength="5" tabindex=11>(1~65535)</td>
	</tr>
	</table>
</td>
</tr>
<tr>
	<td colspan="2" background="liteblue.gif" height="12">&nbsp; </td></tr>
<tr>
	<td colspan="2" align="center">
	<input type="submit" name="apply" value="Apply" onclick="if(!checkData()) return false;">
	<input type="button" name="cancel" value="Cancel" onClick="location.href='FW_pt.htm'"></td></tr>
</table>
<input type="hidden" name="src_ip" value="<% fw_cgi_pt_get_policy_param("src_ip");%>">
<input type="hidden" name="out_port_type" value="0">
</form>
<p>
</p>
</body>
</html>
